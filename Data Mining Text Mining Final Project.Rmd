---
title: "Data Mining Text Mining Final Project"
author: "Madison Yonash"
date: "2023-10-30"
output: html_document
---
# Data Preprocessing

```{r}
#Load Packages
library(tidyverse)
library(taylor)
library(tidytext)
library(tm)
library(SnowballC)
library(wordcloud)
library(RColorBrewer)
library(textdata)
library(knitr)
library(kableExtra)
library(formattable)
library(gridExtra)
library(ggrepel)
library(radarchart)
```

```{r}
#Install packages as needed
#install.packages("radarchart")
```


```{r}
songs <- taylor_album_songs
```

```{r}
glimpse(songs)
```

```{r}
my_words <- c("oh","ooh","eh","ha","mmm","mm", "yeah","ah","hey","eeh","uuh","uh","la","da","di","ra","huh","hu","whoa","gonna","wanna","gotta","em")

tidy_taylor <-
  taylor_album_songs  %>% 
  unnest(lyrics)  %>%  
  unnest_tokens(word, lyric) %>% 
  filter(!word %in% my_words) %>% #Remove undesirables
  filter(!nchar(word) < 3) %>% #Words like "ah" or "oo" used in music
  anti_join(stop_words)

glimpse(tidy_taylor)
```

```{r}
tidy_taylor %>% 
    anti_join(get_stopwords())  %>%  
    count(track_name, word, sort = TRUE)
```



# Exploratory Data Analysis

```{r}

```


# PCA

```{r}

```

# Text Analysis

```{r}
#Create a word cloud to visualize frequent words
#Creating list of stop words to exclude
word <- c("oh","ooh","eh","ha","mmm","mm", "yeah","ah","hey","eeh","uuh","uh","la","da","di","ra","huh","hu","whoa","gonna","wanna","gotta","em")
lexicon <- c(rep("mine",length(word)))
mystopwords <- cbind(word,lexicon)
mystopwords <- rbind(stop_words,mystopwords)
  
#Data preparation
lyric_tokens <- songs %>% 
  select(lyrics) %>% 
  unnest(lyrics)  %>%
  unnest_tokens(input = lyric , output = "word") %>% 
  count(word,sort=TRUE) %>% 
  anti_join(mystopwords,by="word") %>%
  filter(n>10)

#Word cloud
wordcloud(words = lyric_tokens$word,
          freq = lyric_tokens$n,
          scale = c(4,.5),
          max.words = 150,
          colors = "#B59410"
           ) 
```
```{r}
new_sentiments <- get_sentiments("afinn")
names(new_sentiments)[names(new_sentiments) == 'value'] <- 'score'
new_sentiments <- new_sentiments %>% mutate(lexicon = "afinn", sentiment = ifelse(score >= 0, "positive", "nega1tive"),
                                                     words_in_lexicon = n_distinct((word)))
```



```{r}
bing_taylor <- tidy_taylor %>%
  inner_join(get_sentiments("bing"))

nrc_taylor <- tidy_taylor %>%
  inner_join(get_sentiments("nrc"))

nrc_sub_taylor <- tidy_taylor %>%
  inner_join(get_sentiments("nrc")) %>%
  filter(!sentiment %in% c("positive", "negative"))
```

```{r}
nrc_plot <- nrc_taylor %>%
  group_by(sentiment) %>%
  summarise(word_count = n()) %>%
  ungroup() %>%
  mutate(sentiment = reorder(sentiment, word_count)) %>%
  #Use `fill = -word_count` to make the larger bars darker
  ggplot(aes(sentiment, word_count, fill = -word_count)) +
  geom_col() +
  guides(fill = FALSE) + #Turn off the legend
  labs(x = NULL, y = "Word Count") +
  scale_y_continuous(limits = c(0, 3000)) + #Hard code the axis limit
  ggtitle("Taylor Swift NRC Sentiment") +
  theme_minimal() +
  coord_flip()

nrc_plot + scale_fill_taylor_c(album = "Fearless (Taylor's Version)")
```

```{r}
bing_plot <- bing_taylor %>%
  group_by(sentiment) %>%
  summarise(word_count = n()) %>%
  ungroup() %>%
  mutate(sentiment = reorder(sentiment, word_count)) %>%
  ggplot(aes(sentiment, word_count, fill = sentiment)) +
  geom_col() +
  guides(fill = FALSE) +
  scale_fill_manual(values=c("#eedba9", "#ac844c")) +
  theme_minimal() +
  labs(x = NULL, y = "Word Count") +
  scale_y_continuous(limits = c(0, 3000)) +
  ggtitle("Taylor Swift Bing Sentiment") +
  coord_flip()

bing_plot 
```

```{r}
taylor_polarity_chart <- bing_taylor %>%
  count(sentiment, album_name) %>%
  spread(sentiment, n, fill = 0) %>%
  mutate(polarity = positive - negative,
    percent_positive = positive / (positive + negative) * 100)

#Percent positive by chart
pos_chart <- taylor_polarity_chart %>%
  ggplot( aes(x = factor(album_name, album_levels), percent_positive, fill = album_name)) +
  geom_col() +
  scale_fill_taylor_d(album = "Fearless (Taylor's Version)") +
  geom_hline(yintercept = 0) +
  theme_minimal() + theme(plot.title = element_text(size = 11)) +
  xlab(NULL) + ylab(NULL) +
  ggtitle("Percent Positive By Album") +
  theme(legend.position = "none") +
  coord_flip()

pos_chart

```

```{r}
#Polarity by chart
polarity_chart <- taylor_polarity_chart %>%
  ggplot( aes(x = factor(album_name, album_levels), polarity, fill = album_name)) +
  geom_col() +
  scale_fill_taylor_d(album = "Fearless (Taylor's Version)") +
  geom_hline(yintercept = 0) +
  theme_minimal() + theme(plot.title = element_text(size = 11)) +
  xlab(NULL) + ylab(NULL) +
  ggtitle("Polarity By Album") +
  theme(legend.position = "none") +
  coord_flip()

polarity_chart
```


```{r}
plot_words_red <- nrc_taylor %>%
  filter(album_name == "Red (Taylor's Version") %>%
  group_by(sentiment) %>%
  count(word, sort = TRUE) %>%
  arrange(desc(n)) %>%
  slice(seq_len(8)) %>% #consider top_n() from dplyr also
  ungroup()

plot_words_red %>%
  #Set `y = 1` to just plot one variable and use word as the label
  ggplot(aes(word, 1, label = word, fill = sentiment )) +
  #You want the words, not the points
  geom_point(color = "transparent") +
  #Make sure the labels don't overlap
  geom_label_repel(force = 1,nudge_y = .5,  
                   direction = "y",
                   box.padding = 0.04,
                   segment.color = "transparent",
                   size = 3) +
  facet_grid(~sentiment) +
  theme_minimal() +
  theme(axis.text.y = element_blank(), axis.text.x = element_blank(),
        axis.title.x = element_text(size = 6),
        panel.grid = element_blank(), panel.background = element_blank(),
        panel.border = element_rect("lightgray", fill = NA),
        strip.text.x = element_text(size = 9)) +
  xlab(NULL) + ylab(NULL) +
  ggtitle("Red (Taylor's Version) NRC Sentiment") +
  coord_flip()
```
```{r}
tidy_taylor %>%
  filter(album_name %in% "Red (Taylor's Version") %>%
  distinct(word) %>%
  inner_join(get_sentiments("nrc")) %>%
  ggplot(aes(x = word, fill = sentiment)) +
  facet_grid(~sentiment) +
  geom_bar() + #Create a bar for each word per sentiment
  theme_minimal() +
  theme(panel.grid.major.x = element_blank(),
        axis.text.x = element_blank()) + #Place the words on the y-axis
  xlab(NULL) + ylab(NULL) +
  ggtitle("Red (Taylor's Version) Sentiment Words") +
  coord_flip()
```



```{r}
#Get the count of words per sentiment per album
album_sentiment_nrc <- nrc_sub_taylor %>%
  group_by(album_name, sentiment) %>%
  count(album_name, sentiment) %>%
  select(album_name, sentiment, sentiment_album_count = n)

#Get the total count of sentiment words per album (not distinct)
total_sentiment_album <- nrc_sub_taylor %>%
  count(album_name) %>%
  select(album_name, album_total = n)

#Join the two and create a percent field
album_radar_chart <- album_sentiment_nrc %>%
  inner_join(total_sentiment_album, by = "album_name") %>%
  mutate(percent = sentiment_album_count / album_total * 100 ) %>%
  filter(album_name %in% album_levels) %>%
  select(-sentiment_album_count, -album_total) %>%
  spread(album_name, percent) %>%
  chartJSRadar(showToolTipLabel = TRUE,
               main = "NRC Album Radar")
album_radar_chart
```

